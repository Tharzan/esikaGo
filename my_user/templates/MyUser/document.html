{% load static %}
{% load i18n %}
<!DOCTYPE html>
<html lang="fr">
<head>
    <link rel="stylesheet"   media="(min-width:900px)" href="{% static 'css/menu_desktop.css' %}">
    <link rel="stylesheet"   media="(max-width:900px)" href="{% static 'css/menu_mobile.css' %}">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet"   media="(max-width:900px)" href="{% static 'blog/css/blog_mobile.css' %}">
    <link rel="stylesheet"  media="(min-width:900px)"  href="{% static 'my_user/css/document.css' %}">
    
    
    <title>EsikaApp</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">


      
</head>
<body>

    
    <div id="page_">

        {% include 'menu_desktop.html' %}

        <div id="cacher"></div>
        {% include 'petit_menu_ordi_user.html' %}
        


    <div class="container">
        <div class="header">
            <h1 >La Page pour tout vos documents</h1>

            {% if has_security %}
            <div class="Configuration">
                <h2>Vous voulez mettre √† jous vos informations de securit√©?
                    </h2>
                
                <a href="{% url 'security' %}" class="security">mettre √† jour </a>
                    
            </div>
            <p class="about">
                <span role="img" aria-label="shield">üõ°Ô∏è</span> 
                Vous pouvez d√©sormais signer vos documents et effectuer 
                des transactions s√©curis√©es gr√¢ce √† votre identit√© num√©rique Esika.
            </p>
            <br><br>
<hr>
<br><br>

            <div class="btn-container">
                <button class="btn btn-sign" data-action="sign">
                    <span role="img" aria-label="pen">‚úçÔ∏è</span> Signer Document
                </button>
                <button class="btn btn-verify" data-action="verify">
                    <span role="img" aria-label="search">üîç</span> V√©rifier Document
                </button>
                <button class="btn btn-pay" data-action="pay">
                    <span role="img" aria-label="money">üí∞</span> Effectuer Paiement
                </button>
            </div>
        </div>

        <div class="action-block" id="block-sign">
            <h2>‚úçÔ∏è Signature de Document</h2>
            <form action="/api/sign" method="POST" enctype="multipart/form-data">
                <p style="color: red; font-weight: bold;">
                   
                </p>
                <div class="form-group">
                    <label for="sign-key-file">Cl√© Priv√©e (.key) :</label>
                    <input type="file" id="sign-key-file" name="private_key" accept=".key" required>
                </div>
                <div class="form-group">
                    <label for="sign-document">Mot de pass de la cl√©:</label>
                    <input type="password" id="sign-document" name="password" required>
                </div>
                <div class="form-group">
                    <label for="sign-document">Document √† Signer (PDF) :</label>
                    <input type="file" id="sign-document" name="document" required>
                </div>
                 
            <div class="form-group">
                <label>Capture Faciale :    Appuyer sur  la zone</label>
                <div id="video-container">
                    <video id="camera-feed" autoplay playsinline>
                
                    </video>
                </div>
                <button type="button" id="capture-btn" class="btn-capture">Prendre la Photo</button>
                <img id="captured-image-preview" alt="Aper√ßu de la photo captur√©e">
                
                <input type="hidden" name="verification_faciale" id="photo-faciale-base64">
            </div>
                <button type="submit" class="submit-btn btn-sign">Signer et Archiver</button>
            </form>
            <canvas id="camera-canvas"></canvas>
        </div>

        <div class="action-block" id="block-verify">
            <h2>üîç V√©rification de Document</h2>
            <form action="/api/verify" method="POST" enctype="multipart/form-data">
                <p>T√©l√©chargez le document sign√© pour v√©rifier son int√©grit√© et l'identit√© du signataire via le r√©seau Hedera.</p>
                <div class="form-group">
                    <label for="verify-document">Document √† V√©rifier :</label>
                    <input type="file" id="verify-document" name="document_to_verify" required>
                </div>
                <button type="submit" class="submit-btn btn-verify">V√©rifier Signature</button>
            </form>
        </div>

        <div class="action-block" id="block-pay">
            <h2>üí∞ Paiement S√©curis√©</h2>
            <form action="/api/payment" method="POST">
                <p>Initiez un transfert d'argent s√©curis√© par votre identit√© num√©rique.</p>
                <div class="form-group">
                    <label for="pay-destinataire">ID/Nom du Destinataire :</label>
                    <input type="text" id="pay-destinataire" name="destinataire" required>
                </div>
                <div class="form-group">
                    <label for="pay-mobile">Num√©ro Mobile (Confirmation) :</label>
                    <input type="text" id="pay-mobile" name="mobile_number">
                </div>
                <div class="form-group">
                    <label for="pay-bank">Num√©ro Bancaire/Compte :</label>
                    <input type="text" id="pay-bank" name="bank_account">
                </div>
                <div class="form-group">
                    <label for="pay-amount">Montant :</label>
                    <input type="number" id="pay-amount" name="amount" min="1" required>
                </div>
                <div class="form-group">
                    <label for="pay-currency">Devise :</label>
                    <select id="pay-currency" name="currency" required>
                        <option value="USD">USD</option>
                        <option value="EUR">EUR</option>
                        <option value="CDF">CDF</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="pay-method">M√©thode de Paiement :</label>
                    <select id="pay-method" name="payment_method" required>
                        <option value="MOBILE">Mobile Money</option>
                        <option value="BANK">Virement Bancaire</option>
                        <option value="CRYPTO">Crypto (HBAR)</option>
                    </select>
                </div>
               
                <button type="submit" class="submit-btn btn-pay">Confirmer Paiement</button>
            </form>
        </div>

          
            {% else %}
            <div class="Configuration">
    <h2>üîë Configuration de S√©curit√© Requise </h2>
    <p> Pour des raisons de s√©curit√©, vous devez configurer votre cl√© priv√©e et la reconnaissance faciale.

Cette configuration est essentielle pour vous permettre de **signer num√©riquement** tous vos documents de mani√®re s√©curis√©e (quittances, contrats, etc.). Une fois sign√©s, vous pourrez les partager avec toute personne ou entit√© tierce pour une v√©rification imm√©diate.
</p> <p> Veuillez proc√©der √† cette configuration pour d√©verrouiller l'acc√®s aux fonctionnalit√©s de signature et d'ancrage Hedera. </p>
    <a href="{% url 'security' %}" class="security">Configurer votre cl√©</a>
        
</div>

            {% endif %}
            
    </div>
<script src="{% static 'java/jquery.js' %}"></script>
<script src="{% static 'java/java_all.js' %}"></script>
<script src="{% static 'my_user/java/security.js' %}"></script>

    <script>
        $(document).ready(function() 
        {
        var svg_profile =$('.svg_security');

        svg_profile.attr('fill','#f39c12').css('width','40px').css('height','40px').css('background-color','#eee').css('padding','5px');
        
        });
        /* --- Logique JavaScript --- */
        document.addEventListener('DOMContentLoaded', () => {
            const buttons = document.querySelectorAll('.btn-container .btn');
            const actionBlocks = document.querySelectorAll('.action-block');

            buttons.forEach(button => {
                button.addEventListener('click', (event) => {
                    const action = event.currentTarget.dataset.action;
                    const targetBlockId = `block-${action}`;

                    // 1. Cacher tous les blocs
                    actionBlocks.forEach(block => {
                        block.style.display = 'none';
                    });

                    // 2. Afficher le bloc cibl√©
                    const targetBlock = document.getElementById(targetBlockId);
                    if (targetBlock) {
                        targetBlock.style.display = 'block';
                        targetBlock.scrollIntoView({ behavior: 'smooth' }); // D√©filer vers le bloc
                    }
                });
            });
        });
    </script>

</body>
</html>